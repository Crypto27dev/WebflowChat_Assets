(this.webpackJsonpchatapp=this.webpackJsonpchatapp||[]).push([[0],{106:function(e,t,a){},107:function(e,t,a){},132:function(e,t,a){},133:function(e,t,a){},134:function(e,t,a){},135:function(e,t,a){},136:function(e,t,a){},137:function(e,t,a){},138:function(e,t,a){},143:function(e,t,a){},148:function(e,t,a){"use strict";a.r(t);var c=a(0),n=a(52),r=a.n(n),s=(a(106),a(5)),i=a(18),o=a(11),l=(a(107),a(15)),u=a.n(l),d=a(98),j=a(6),b=function(e,t){switch(t.type){case"LOGIN_START":return{user:t.payload,isLoading:!0,error:!1};case"LOGIN_SUCCESS":return{user:t.payload,isLoading:!1,error:!1};case"LOGIN_FAILURE":return{user:null,isLoading:!1,error:t.payload};default:return e}},p=a(2),m={user:localStorage.getItem("user")?JSON.parse(localStorage.getItem("user")):null,isFetching:!1,error:!1},O=Object(c.createContext)(m),f=function(e){var t=e.children,a=Object(c.useReducer)(b,m),n=Object(j.a)(a,2),r=n[0],s=n[1],i=Object(c.useState)(""),o=Object(j.a)(i,2),l=o[0],u=o[1];return Object(c.useEffect)((function(){"string"!==typeof r.user&&localStorage.setItem("user",JSON.stringify(r.user))}),[r.user]),Object(p.jsx)(O.Provider,{value:{user:r.user,isFetching:r.isFetching,error:r.error,userId:l,setUserId:u,dispatch:s},children:t})};var h=function(){var e=Object(c.useContext)(O),t=e.dispatch,a=(e.setUserId,Object(o.f)()),n="https://api.upit.no/",r={"X-API-KEY":"sk_sb_13585305fc08b12a8939"},l=Object(o.g)().msg;console.log(">><<",window.location.search,l),Object(c.useEffect)((function(){var e=window.location.search.replace("?","");m(e,t)}),[]);var j=function(){var e=Object(i.a)(Object(s.a)().mark((function e(t){var a;return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,u.a.get("".concat("https://admin.memberstack.com/members","/").concat(t),{headers:r});case 3:return a=e.sent,e.abrupt("return",a.data.data);case 7:e.prev=7,e.t0=e.catch(0),console.log(e.t0);case 10:return e.abrupt("return",null);case 11:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t){return e.apply(this,arguments)}}(),b=function(){var e=Object(i.a)(Object(s.a)().mark((function e(t){var a;return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,j(t);case 3:return a=e.sent,e.next=6,u.a.post(n+"api/auth/signin",{firstname:a.customFields.fornavn,lastname:a.customFields.etternavn,email:a.auth.email,mem_id:a.id,avatar:a.customFields.profilbilde});case 6:e.sent,e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),console.log("Register Err:",e.t0);case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(t){return e.apply(this,arguments)}}(),m=function(){var e=Object(i.a)(Object(s.a)().mark((function e(t,c){var r,i,o,l,d;return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c({type:"LOGIN_START"}),e.prev=1,r=t.replace("/chatapp/",""),i=JSON.parse(atob(r)),o={email:i.email,mem_id:i.mem_id},e.next=7,j(o.mem_id);case 7:return l=e.sent,e.next=10,u.a.post(n+"api/auth/signin",{firstname:l.customFields.fornavn,lastname:l.customFields.etternavn,email:l.auth.email,mem_id:l.id,avatar:l.customFields.profilbilde});case 10:if(d=e.sent,null===i||void 0===i||!i.to){e.next=14;break}return e.next=14,b(i.to);case 14:c({type:"LOGIN_SUCCESS",payload:d.data}),a.push("/user/".concat(i.to)),e.next=22;break;case 18:e.prev=18,e.t0=e.catch(1),console.log("Login Err:",e.t0),c({type:"LOGIN_FAILURE",payload:e.t0});case 22:case"end":return e.stop()}}),e,null,[[1,18]])})));return function(t,a){return e.apply(this,arguments)}}();return Object(p.jsxs)("div",{className:"signin-container",children:[Object(p.jsx)("div",{children:Object(p.jsx)(d.a,{visible:!0,height:"80",width:"80",ariaLabel:"comment-loading",wrapperStyle:{},wrapperClass:"comment-wrapper",color:"#316af3",backgroundColor:"#fff"})}),Object(p.jsx)("footer",{children:Object(p.jsx)("span",{children:"@Copyright2023"})})]})},v=a(39),x=(a(132),a(133),a(134),a(135),a(71));var g=function(e){var t=e.message,a=e.own,n=Object(c.useState)(""),r=Object(j.a)(n,2),s=r[0],i=r[1];return Object(c.useEffect)((function(){i(Object(x.a)(t.createdAt));var e=setInterval((function(){i(Object(x.a)(t.createdAt))}),1e3);return function(){return clearInterval(e)}}),[t]),Object(p.jsx)("div",{children:Object(p.jsxs)("p",{className:a?"message-sent":"message-received",children:[Object(p.jsx)("span",{children:t.text}),Object(p.jsx)("span",{className:"message-time",children:s})]})})};a(136);var N=function(e){var t=e.addchattoggler,a=e.addchattoggle,n=Object(c.useState)(),r=Object(j.a)(n,2),o=r[0],l=r[1],d=Object(c.useContext)(O).user,b="https://api.upit.no/",m=function(){var e=Object(i.a)(Object(s.a)().mark((function e(t){var a,c;return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),e.prev=1,e.next=4,u.a.get("".concat(b,"api/users/?username=").concat(o));case 4:return a=e.sent,l(""),c={senderId:d._id,receiverId:a.data._id},e.next=9,u.a.post(b+"api/chatrooms",c);case 9:e.next=13;break;case 11:e.prev=11,e.t0=e.catch(1);case 13:window.location.reload();case 14:case"end":return e.stop()}}),e,null,[[1,11]])})));return function(t){return e.apply(this,arguments)}}();return Object(p.jsx)("div",{className:"add-amigo-background",children:Object(p.jsxs)("div",{className:a?"add-amigo-open":"add-amigo-close",children:[Object(p.jsx)("div",{className:"close-div",children:Object(p.jsx)("span",{onClick:t,children:Object(p.jsx)("p",{className:"close-symbol",children:"x"})})}),Object(p.jsxs)("form",{children:[Object(p.jsx)("img",{className:"add-amigo-img",src:"assets/addamigo.png",alt:""}),Object(p.jsx)("input",{type:"text",placeholder:"Enter Username of Amigo",value:o,onChange:function(e){l(e.target.value)},required:!0}),Object(p.jsx)("button",{onClick:m,children:"ADD AMIGO"})]})]})})},w=a(61),k=a.n(w);a(137);var S=function(e){var t=e.toggler,a=e.togglestate,n=Object(c.useContext)(O).user,r=Object(c.useState)((null===n||void 0===n?void 0:n.firstname)+" "+(null===n||void 0===n?void 0:n.lastname)),s=Object(j.a)(r,2),i=(s[0],s[1],Object(c.useState)("")),o=Object(j.a)(i,2),l=(o[0],o[1],"https://api.upit.no/");return Object(p.jsx)("div",{className:"profile",children:Object(p.jsxs)("div",{className:a?"profile-card-open":"profile-card-close",children:[Object(p.jsx)("div",{className:"close-div",children:Object(p.jsx)("span",{onClick:t,children:Object(p.jsx)(k.a,{fontSize:"large"})})}),Object(p.jsx)("img",{className:"profile-image",src:null!==n&&void 0!==n&&n.avatar?n.avatar:l+"api/images/noavatar.png",alt:""}),Object(p.jsxs)("form",{children:[Object(p.jsx)("label",{children:"User Name"}),Object(p.jsxs)("div",{className:"user-input",children:[null===n||void 0===n?void 0:n.firstname," ",null===n||void 0===n?void 0:n.lastname]}),Object(p.jsx)("label",{children:"Email"}),Object(p.jsx)("div",{className:"user-input",children:null===n||void 0===n?void 0:n.email}),Object(p.jsx)("button",{type:"button",onClick:t,children:"Close"})]})]})})},y=(a(138),a(64));var C=function(e){var t=e.chatroomtile,a=e.currentUser,n=Object(c.useState)(null),r=Object(j.a)(n,2),o=r[0],l=r[1],d=Object(c.useState)(!1),b=Object(j.a)(d,2),m=b[0],O=b[1],f=Object(c.useRef)(),h="https://api.upit.no/";return Object(c.useEffect)((function(){f.current=Object(y.a)(h)}),[h]),Object(c.useEffect)((function(){var e=t.members.find((function(e){return e!==a._id}));f.current.on("getUsers",(function(t){O(t.find((function(t){return t.userId===e})))}));var c=function(){var t=Object(i.a)(Object(s.a)().mark((function t(){var a;return Object(s.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,u.a.get(h+"api/users/"+e);case 3:a=t.sent,l(a.data),t.next=10;break;case 7:t.prev=7,t.t0=t.catch(0),console.log(t.t0);case 10:case"end":return t.stop()}}),t,null,[[0,7]])})));return function(){return t.apply(this,arguments)}}();c()}),[a,t,m,h]),Object(p.jsxs)("div",{className:"sidebarchat",children:[Object(p.jsxs)("div",{children:[Object(p.jsx)("img",{className:"amigo-profilepic",src:null!==o&&void 0!==o&&o.avatar?o.avatar:h+"api/images/noavatar.png",alt:""}),Object(p.jsx)("div",{className:m?"online":"offile"})]}),Object(p.jsx)("p",{className:"sidebarchat-info-name",children:o?(null===o||void 0===o?void 0:o.firstname)+" "+(null===o||void 0===o?void 0:o.lastname):""})]})};a(143);var I=function(){return Object(p.jsx)("div",{children:Object(p.jsxs)("div",{className:"EmptyChatroom",children:[Object(p.jsx)("img",{className:"emptychatroom-img",src:"https://api.upit.no/api/images/home.png",alt:""}),Object(p.jsx)("p",{className:"empty-chatroom-mainhead",children:"Welcome To Our Upit Chat!"})]})})},_=(a(144),a(99)),E=a(97),L=a.n(E),U=a(92),A=a.n(U),F=a(94),R=a.n(F),G=a(164),T=a(93),D=a.n(T),J=a(96),z=a.n(J),M=a(95),q=a.n(M);var P=function(){var e=Object(c.useState)([]),t=Object(j.a)(e,2),a=t[0],n=t[1],r=Object(c.useState)(null),o=Object(j.a)(r,2),l=o[0],d=o[1],b=Object(c.useState)([]),m=Object(j.a)(b,2),f=m[0],h=m[1],x=Object(c.useState)(""),w=Object(j.a)(x,2),E=w[0],U=w[1],F=Object(c.useState)(null),T=Object(j.a)(F,2),J=T[0],M=T[1],P=Object(c.useState)(),B=Object(j.a)(P,2),K=B[0],V=B[1],W=Object(c.useState)(!1),X=Object(j.a)(W,2),Y=X[0],H=X[1],Q=Object(c.useContext)(O).user,Z=Object(c.useRef)(),$=Object(c.useRef)();console.log("<><><<>",window.location.search);var ee=window.location.search,te="https://api.upit.no/";Object(c.useEffect)((function(){$.current=Object(y.a)(te),$.current.on("getMessage",(function(e){M({sender:e.senderId,text:e.text,createdAt:Date.now()})}))}),[te]),Object(c.useEffect)((function(){J&&(null===l||void 0===l?void 0:l.members.includes(J.sender))&&h((function(e){return[].concat(Object(v.a)(e),[J])}))}),[J,l]),Object(c.useEffect)((function(){$.current.emit("addUser",null===Q||void 0===Q?void 0:Q._id)}),[Q,a,l,$]),Object(c.useEffect)((function(){var e=function(){var e=Object(i.a)(Object(s.a)().mark((function e(){return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),t=function(){var e=Object(i.a)(Object(s.a)().mark((function e(){var t,a,c,r;return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,t=null,"default"===ee){e.next=9;break}return e.next=5,u.a.get("".concat(te,"api/users/?member=").concat(ee));case 5:return a=e.sent,t={senderId:Q._id,receiverId:a.data._id},e.next=9,u.a.post(te+"api/chatrooms",t);case 9:return e.next=11,u.a.get(te+"api/chatrooms/"+Q._id);case 11:if(c=e.sent,n(c.data),!t){e.next=18;break}return e.next=16,u.a.get(te+"api/chatrooms",t);case 16:r=e.sent,d(r.data[0]);case 18:e.next=23;break;case 20:e.prev=20,e.t0=e.catch(0),console.log(e.t0);case 23:case"end":return e.stop()}}),e,null,[[0,20]])})));return function(){return e.apply(this,arguments)}}();Object(i.a)(Object(s.a)().mark((function a(){return Object(s.a)().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if("default"===ee){a.next=3;break}return a.next=3,e();case 3:return a.next=5,t();case 5:case"end":return a.stop()}}),a)})))()}),[null===Q||void 0===Q?void 0:Q._id,te]),Object(c.useEffect)((function(){var e=null===l||void 0===l?void 0:l.members.find((function(e){return e!==Q._id})),t=function(){var t=Object(i.a)(Object(s.a)().mark((function t(){var a;return Object(s.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,u.a.get(te+"api/users/"+e);case 3:a=t.sent,V(a.data),t.next=9;break;case 7:t.prev=7,t.t0=t.catch(0);case 9:case"end":return t.stop()}}),t,null,[[0,7]])})));return function(){return t.apply(this,arguments)}}();l&&t()}),[Q,l,te]),Object(c.useEffect)((function(){var e=function(){var e=Object(i.a)(Object(s.a)().mark((function e(){var t;return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,u.a.get(te+"api/messages/"+(null===l||void 0===l?void 0:l._id));case 3:t=e.sent,h(t.data),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),console.log(e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(){return e.apply(this,arguments)}}();l&&e()}),[l,te]),Object(c.useEffect)((function(){var e;null===(e=Z.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})}),[f]);var ae=Object(c.useState)(!1),ce=Object(j.a)(ae,2),ne=ce[0],re=ce[1],se=function(){var e=Object(i.a)(Object(s.a)().mark((function e(t){var a,c,n;return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),a={chatroomId:l._id,senderId:Q._id,text:E},c=l.members.find((function(e){return e!==Q._id})),$.current.emit("sendMessage",{senderId:Q._id,receiverId:c,text:E}),e.prev=4,e.next=7,u.a.post(te+"api/messages/",a);case 7:n=e.sent,h([].concat(Object(v.a)(f),[n.data])),U(""),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(4),console.log(e.t0);case 15:re(!1);case 16:case"end":return e.stop()}}),e,null,[[4,12]])})));return function(t){return e.apply(this,arguments)}}(),ie=Object(c.useState)(!1),oe=Object(j.a)(ie,2),le=oe[0],ue=oe[1],de=Object(c.useState)(!1),je=Object(j.a)(de,2),be=je[0],pe=je[1],me=function(){pe(!1===be)};return console.log(">>>",a),Object(p.jsxs)("div",{className:"home",children:[Object(p.jsx)(N,{addchattoggler:function(){ue(!1===le),console.log(le)},addchattoggle:le}),Object(p.jsx)(S,{toggler:function(){me()},togglestate:be}),Y?"":Object(p.jsx)("div",{className:"menu-open",onClick:function(){H(!0)},children:Object(p.jsx)(G.a,{children:Object(p.jsx)(A.a,{style:{fontSize:35,color:"#316af3"}})})}),Object(p.jsxs)("div",{className:"home-components",children:[Object(p.jsxs)("div",{className:Y?"sidebar active":"sidebar",children:[Object(p.jsxs)("div",{className:"sidebar-header",children:[Object(p.jsx)("div",{className:"menu-close",onClick:function(){H(!1)},children:Object(p.jsx)(G.a,{children:Object(p.jsx)(k.a,{style:{fontSize:35,color:"white"}})})}),Object(p.jsx)(G.a,{onClick:function(){me()},children:Object(p.jsx)("img",{className:"user-profile-image",src:null!==Q&&void 0!==Q&&Q.avatar?Q.avatar:te+"api/images/noavatar.png",alt:""})}),Object(p.jsx)("div",{className:"logout-option",children:Object(p.jsx)(G.a,{onClick:function(){localStorage.removeItem("user"),window.location.reload()},children:Object(p.jsx)(D.a,{})})})]}),Object(p.jsx)("div",{className:"sidebar-search",children:Object(p.jsxs)("div",{className:"sidebar-search-container",children:[Object(p.jsx)(R.a,{className:"sidebar-searchicon"}),Object(p.jsx)("input",{type:"text",name:"chat-search",placeholder:"Search a Chat"})]})}),Object(p.jsx)("div",{className:"sidebar-chatoptions",children:a.map((function(e,t){return Object(p.jsx)("div",{onClick:function(){d(e),H(!1)},children:Object(p.jsx)(C,{chatroomtile:e,currentUser:Q})},t)}))})]}),Object(p.jsx)("div",{className:"chatroom",children:l?Object(p.jsxs)(p.Fragment,{children:[Object(p.jsx)("div",{className:"chatroom-header",children:Object(p.jsxs)("div",{className:"chatroom-chatinfo",children:[Object(p.jsx)("img",{className:"amigo-profilepic",src:null!==K&&void 0!==K&&K.avatar?K.avatar:te+"api/images/noavatar.png",alt:""}),Object(p.jsx)("div",{className:"chatroom-chatinfo-right",children:Object(p.jsx)("div",{className:"chatroom-chatinfo-name",children:Object(p.jsx)("p",{children:K?K.firstname+" "+K.lastname:""})})})]})}),Object(p.jsx)("div",{className:"chatroom-messages-container",onClick:function(){re(!1)},children:f.map((function(e,t){return Object(p.jsx)("div",{ref:Z,children:Object(p.jsx)(g,{message:e,own:(null===e||void 0===e?void 0:e.senderId)===Q._id})},t)}))}),Object(p.jsx)("div",{className:ne?"emoji-picker-open":"emoji-picker-close",children:Object(p.jsx)(_.a,{onSelect:function(e){var t=e.native;U(E+t)},emojiSize:25})}),Object(p.jsxs)("div",{className:"chatroom-footer",children:[Object(p.jsxs)("div",{className:"chatroom-footer-lefticons",children:[Object(p.jsx)(G.a,{onClick:function(){re(!ne)},children:Object(p.jsx)(q.a,{})}),Object(p.jsx)(G.a,{children:Object(p.jsx)(z.a,{})})]}),Object(p.jsxs)("form",{children:[Object(p.jsx)("input",{className:"message-input",type:"text",name:"message-input",placeholder:"Type a message",onChange:function(e){U(e.target.value)},value:E,required:!0}),Object(p.jsx)("button",{className:"input-button",onClick:E?se:null,children:" Send a Message "})]}),Object(p.jsx)("div",{className:"chatroom-footer-righticon",onClick:E?se:null,children:Object(p.jsx)(G.a,{children:Object(p.jsx)(L.a,{className:"send-icon"})})})]})]}):Object(p.jsx)(I,{})})]})]})},B=a(60);var K=function(){return Object(c.useContext)(O).user,Object(p.jsx)(B.a,{children:Object(p.jsx)("div",{className:"App",children:Object(p.jsxs)(o.c,{children:[Object(p.jsx)(o.a,{exact:!0,path:"/:msg",component:h}),Object(p.jsx)(o.a,{path:"/user/:member",component:P})]})})})};r.a.render(Object(p.jsx)(f,{children:Object(p.jsx)(K,{})}),document.getElementById("root"))}},[[148,1,2]]]);